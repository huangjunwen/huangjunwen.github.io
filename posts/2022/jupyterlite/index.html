<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jupyterlite</title>
    
    <link rel="stylesheet" href="/res/libs/fontawesome/css/all.min.css"></link>
    <link rel="stylesheet" href="/res/libs/chota/css/chota.min.css"></link>
    <link rel="stylesheet" href="/res/style/site.min.1cfb2065638c6eda7f5ceb0b60110baf5593ae09a1298e64096971386bd084ca.css"></link>
    <script type="text/javascript" src="/res/script/site.min.6881188133395162222bed24f23dd6cbdd74f0b93a54b35a6b929b5178e10fe9.js"></script>
    <link id="markdown-body-style" rel="stylesheet" href="/res/style/markdown-body.min.fbc98dd0188bbc6cff6adb3737a0533833576a79ec29055581d245edb0581ac0.css"></link>
    <script type="text/javascript" src="/res/script/markdown-body.min.a6a10b3328945990fade36e6fee4eab6131402292da617dc8c6d0258507f0c72.js"></script>
  </head>

  <body>
    
    <div id="header">
      
      <nav id="navbar" class="row">
        <div class="is-left col-12 col-3-md row">
          <a id="navbar-brand" class="brand" href="/">Coder Papa</a>
          <label id="navbar-toggle-menu" for="navbar-toggle-menu-state" class="hide-md hide-lg">
            <span></span>
            <span></span>
            <span></span>
          </label>
        </div>
        <input id="navbar-toggle-menu-state" type="checkbox" style="display:none"></input>
        <div id="navbar-menu" class="is-right col-12 col-9-md row hide-xs-noimportant hide-sm-noimportant">
          
          <a href="/posts">Posts</a>
          
          
          <a href="/categories">Categories</a>
          
          <a href="/tags">Tags</a>
          
          
          <a href="https://github.com/huangjunwen"><i class='fab fa-github'></i></a>
          
          <a href="javascript:void(0)" id="navbar-toggle-mode" onclick="return toggleColorMode()"></a>
        </div>
      </nav>
    </div>

    
    <div id="main" class="row">
      <div id="main-left" class="hide-xs hide-sm col-2-md col-3-lg">
        
      </div>
      <div id="main-center" class="col-12 col-8-md col-6-lg mdb">
        <div id="main-title" class="text-center">
          
  <h5 class="no-toc"><span class="breadcrumbnav"><span><a href="/posts/">POSTS</a></span><i class="fa fa-fw fa-angle-double-right"></i><span><a href="/posts/2022/">2022</a></span></span></h5>
  <h1>Jupyterlite</h1>
  <small>
    <time class="" datetime="2022-08-27T10:14:17Z">Sat, 2022/08/27</time>
  </small>
  <p>
    
    <a href="/tags/python/"><span class="tag is-small">python</span></a>
    
  </p>
  
        </div>
        <div id="main-body">
          
  <article id="content-body">
    <p>最近总是接触各种
Jupyter…（JupyterNotebook/JupyterHub），发现居然还有可以完全跑在浏览器上的
<a
href="https://github.com/jupyterlite/jupyterlite">Jupyterlite</a>，那是不是可以直接放一个到这儿呢？</p>
<h2 id="大致的概念">大致的概念</h2>
<p>原来的 JupyterNotebook 是传统的 CS 模式，各种语言（e.g. python）的
kernel 是跑在服务端的</p>
<p>但现在 python（和一些常用的库）也有了 WebAssembly 的移植版（e.g. <a
href="https://pyodide.org/en/stable/">pyodide</a>）， 这样 kernel
也可以在浏览器上实现了 （e.g. <a
href="https://jupyterlite.readthedocs.io/en/latest/quickstart/using.html#a-python-kernel-powered-by-pyodide">pyolite</a>），
因此也就可以创建一个全静态的 site，UI 和 kernel 都在浏览器中运行，
中间用 <a
href="https://jupyterlite.readthedocs.io/en/latest/quickstart/using.html#kernels">mock-socket</a>
假装通讯， 这样就可以把 notebook 那一套 CS 模式移植过来</p>
<h2 id="部署流程">部署流程</h2>
<h3 id="安装-jupyterlite-cli">安装 jupyterlite CLI</h3>
<p><code
class="language-plaintext">pip install --pre jupyterlite</code>（现在还处于
<a
href="https://github.com/jupyterlite/jupyterlite/releases/tag/v0.1.0b12">pre-release</a>
的状态）</p>
<h3 id="生成-site">生成 site</h3>
<p>引自 jupyterlite CLI <a
href="https://jupyterlite.readthedocs.io/en/latest/reference/cli.html#cli">文档</a>，</p>
<blockquote>
<p>The jupyter lite (or jupyter-lite) CLI provides tools for lifecycle
of combining…</p>
<ul>
<li>the core JupyterLite static assets</li>
<li>extra application features like Lab Extensions and settings</li>
<li>kernel-specific resources like Python wheels</li>
<li>user-authored content like Notebooks</li>
</ul>
<p>… into a ready-to-deploy (and optionally reproducible) Jupyter sites
which require an HTTP server, but no application server.</p>
</blockquote>
<p>主要命令 <a
href="https://jupyterlite.readthedocs.io/en/latest/reference/cli.html#build"><code
class="language-plaintext">jupyter lite build</code></a>，一些重要参数</p>
<ul>
<li><code class="language-plaintext">--config</code> 可以指定一个 JSON
配置，默认是当前目录下名为 <code
class="language-plaintext">jupyter_lite_config.json</code> 的文件，
例子可看<a
href="https://github.com/jupyterlite/jupyterlite/blob/main/examples/jupyter_lite_config.json">这里</a></li>
<li><code class="language-plaintext">--lite-dir</code> 指定 <a
href="https://jupyterlite.readthedocs.io/en/latest/reference/cli.html#the-lite-dir">LiteDir</a>，
这个目录主要包含用户提供的内容等</li>
<li><code class="language-plaintext">--output-dir</code> 输出 site
的目录</li>
</ul>
<h3 id="例子">例子</h3>
<p>以下是一个 build script 和配置的例子：它会首先创建 python virutal env
然后安装 jupyterlite 最后 build 一个 site 到目录 <code
class="language-plaintext">jl</code> 中， 这里根据 <a
href="https://jupyterlite.readthedocs.io/en/latest/howto/configure/advanced/offline.html">Create
a JupyterLite archive that can be used offline</a> 下载完整的 pyodide
以及 mathjax（不需要用 CDN），另外也示范性地添加预下载的 <code
class="language-plaintext">pyjokes</code> wheel（不需要从 pypi 下载），
这样创建出来的 site 即使完全不联网也是能运作的，只是体积比较大</p>
<ul>
<li><p><code class="language-plaintext">build.sh</code></p>
<pre class="language-bash"><code>#!/bin/bash

# Directory containing build.sh
SCRIPT_DIR=$( cd -- &quot;$( dirname -- &quot;${BASH_SOURCE[0]}&quot; )&quot; &amp;&gt; /dev/null &amp;&amp; pwd )
# Python venv
VENV_DIR=$SCRIPT_DIR/venv
# Pyodide download path
PYODIDE_VER=0.21.1
PYODIDE_PATH=$SCRIPT_DIR/pyodide.tar.bz2
# Output directory
OUTPUT_DIR=$SCRIPT_DIR/jl

echo &quot;==== Script dir: $SCRIPT_DIR&quot;
echo &quot;==== Python venv dir: $VENV_DIR&quot;
echo &quot;==== Pyodide version: $PYODIDE_VER&quot;
echo &quot;==== Pyodide path: $PYODIDE_PATH&quot;
echo &quot;==== Output dir: $OUTPUT_DIR&quot;

cd $SCRIPT_DIR

if [ ! -d $VENV_DIR ]; then
  echo &quot;==== Python venv not found, create a new one&quot;
  python3 -m venv $VENV_DIR
else
  echo &quot;==== Python venv found&quot;
fi

echo &quot;==== Activating venv&quot;
source $VENV_DIR/bin/activate

echo &quot;==== Run pip install jupyterlite[piplite,mathjax]&quot;
pip install --pre jupyterlite[piplite,mathjax]

if [ ! -f $PYODIDE_PATH ]; then
  echo &quot;==== Pyodide not found, try to download... (or you can manally download it)&quot;
  wget --verbose -O $PYODIDE_PATH \
    https://github.com/pyodide/pyodide/releases/download/${PYODIDE_VER}/pyodide-build-${PYODIDE_VER}.tar.bz2
else
  echo &quot;==== Pyodide found&quot;
fi

echo &quot;==== Run jupyter lite build...&quot;
jupyter lite build --lite-dir=$SCRIPT_DIR --output-dir=$OUTPUT_DIR --pyodide=$PYODIDE_PATH --config=$SCRIPT_DIR/jupyter_lite_config.json
</code></pre></li>
<li><p><code
class="language-plaintext">jupyter_lite_config.json</code></p>
<pre class="language-json"><code>{
  &quot;LiteBuildConfig&quot;: {
    &quot;piplite_urls&quot;: [
      &quot;https://files.pythonhosted.org/packages/6a/0e/4a824a4fc93b9725a985fcea7115927b72f2ca6966008300a982cb869720/pyjokes-0.6.0-py2.py3-none-any.whl&quot;
    ]
  }
}</code></pre></li>
</ul>
<h3 id="部署">部署</h3>
<p>部署方式有多种，例如可以在 github 上新建一个名为 <code
class="language-plaintext">jupyterlite</code> 的项目，把刚才生成的 site
push 上去，并且设置 github page， 这样它就可以在 <code
class="language-plaintext">&lt;username&gt;.github.io/jupyterlite</code>
这个路径上访问得到了</p>
<h3 id="内容">内容</h3>
<p>如上所述，可将内容（<code
class="language-plaintext">*.ipynb</code>）放置到 LiteDir 的 <code
class="language-plaintext">files</code> 目录中，再次跑 build script
即可更新到 site 中</p>
<h2 id="使用">使用</h2>
<h3 id="不同之处">不同之处</h3>
<p>原 CS 模式下，packages 是在服务器上安装好，可以直接 <code
class="language-plaintext">import</code>，而在 jupyterlite 中，似乎除
pyodide 自带的那些包外， 需要首先 <code
class="language-plaintext">piplite.install</code> 才能 <code
class="language-plaintext">import</code>，例如：</p>
<pre class="language-python code"><code>import pyjokes
pyjokes</code></pre>
<p>这是会失败的</p>
<pre class="language-python code"><code>import piplite
await piplite.install(&#39;pyjokes&#39;)
import pyjokes
pyjokes.get_joke()</code></pre>
<p>这样才行，看看<a
href="/jupyterlite/lab?path=posts%2F2022%2Fjupyterlite%2Findex.ipynb">效果</a></p>
<p>注：上面将 whl url 写到 <code
class="language-plaintext">piplite_urls</code> 中只是将 wheel 提前下载到
site 中，并告诉 jupyterlite 如果要 piplite install 这个包则不要去 pypi
找而是在 site 里找，但要使用它之前还是需要 <code
class="language-plaintext">piplite.install</code> 的</p>

  </article>

        </div>
      </div>
      <div id="main-right" class="hide-xs hide-sm col-2-md col-3-lg">
        
  
  <div id="content-toc" class="toc hide-md"></div>
  

      </div>
    </div>

    
    <div id="footer" class="text-center">
      <p>
        Powered By <a href="https://gohugo.io/">Hugo</a>/<a href="https://jenil.github.io/chota">Chota</a>,
        Generated Using <a href="https://github.com/huangjunwen/mdtool">MDTool</a>
      </p>
      <p>&copy; 2022. All rights reserved</p>
    </div>

    
  
    <link rel="stylesheet" href="/res/libs/tocbot/css/tocbot.css"></link>
    <style>
    #content-toc {
      position: -webkit-sticky;
      position: sticky;
      top: 7rem;
      padding-left: 2rem;
      padding-right: 1rem;
    }

    #content-toc a.toc-link {
      color: var(--font-color);
    }

    #content-toc a.toc-link.is-active-link {
      color: var(--color-darkGrey);
    }

    #content-toc a.toc-link::before {
      background-color: var(--bg-color);
    }

    #content-toc a.toc-link.is-active-link::before {
      background-color: var(--color-primary);
    }
    </style>
    <script src="/res/libs/tocbot/js/tocbot.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', (ev) => {
      tocbot.init({
        tocSelector: '#content-toc',
        contentSelector: '#main-center',
        ignoreSelector: '.no-toc',
        headingSelector: 'h1, h2, h3, h4, h5, h6',
        hasInnerContainers: false,
        headingsOffset: 80,
        scrollSmoothOffset: -80
      });
    });
    </script>
  
  
    <script type="text/javascript" src="/res/libs/anchorjs/js/anchor.min.js"></script>
    <script>anchors.add('#main-body h1, #main-body h2, #main-body h3, #main-body h4, #main-body h5, #main-body h6, #main-body dt');</script>
  

  </body>
</html>
